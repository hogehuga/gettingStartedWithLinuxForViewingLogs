# gettingStartedWithLinuxForViewingLogs
Getting Started with Linux for Viewing Logs. ログを見るために、Linuxで最低限に学んでほしいもの。

----

---
marp: true
---
# 0. 方針
​
「ログ確認の為のコンソール操作の学習」の場合、以下のパターンで学習するとよいかもしれない。
​
1. Shell(bash)の基礎を覚える
2. まずはコマンドを覚える
3. コマンドを組み合わせる
4. 正規表現の使い方を覚える
5. 演習
​
---
# 1. シェルの基礎

---
## 1.a. シェルの基礎
​
- コンソールの起動は、デスクトップで `Ctr+Alt+T` を押す、メニューからコンソールを選ぶ。
- コンソールについて、一般ユーザは `$`、rootは `#` であらわされる
  - `$ ls` は、一般ユーザで `ls`コマンドを実行することを意味する
  - `# rm /` は、rootユーザで `rm  /`コマンドを実行することを意味する
- root権限の利用は`sudo`を使う
  - `$ sudo rm /`は、管理者権限で`rm /`を実行
  - `$ sudo -s`は、rootでshellを起動する=rootとして捜査
    - see /etc/sudoers
  - 一般的には、`$ sudo <管理者として実行したいコマンド>`で実行する。これにより実行ユーザなどが記録される。
​
---
## 1.b. シェルの基礎(コマンドの連携とファイル出力)
​
- コマンド結果を受け渡す `>`と`|`(pipe)
  - `$ echo "abc" > text.txt`とすると、echoの出力結果`abc`を、`text.txt`というファイルに書き込める
  - `$ cat text.txt | sort`とすると、`text.txt`ファイルの中身を`sort`コマンドで順番に並べ替える
    - 文字列を複数の処理をする場合は、`|`でコマンドをつないでデータを渡す
  - 詳細は、コマンドを覚えた後で試して覚える。
​
---
# 2. コマンドを覚える​

---
## 2.a. コマンドを覚える
​
例示されたコマンドを、ヘルプやネットを見て調べて、オプションや使い方を覚える。
​
順番は以下の通りを想定する。
- ファイル操作
  - ファイル詳細表示、コピー/削除/複製、詳細表示
- ファイル内容に対する操作
  - 編集やソートなど
- コマンドの組み合わせ
- 正規表現と正規表現での処理
​
---
### 2.a.1. ファイル操作に関するコマンド
分からないコマンドは `man コマンド`で調べる
​
- cd: ChangeDirectory
- cp: CoPy file and directories
- rm: ReMove files or directorys
- mv: MoVe (rename) files
- ls: LiSt directory contents
- man: an interface to the system reference MANuals

---
### 2.a.2. ファイル内容に対する操作
​
- file: determine file type
- head: output the first part of files
- tail: output the last part of files
- sort: sort lines of text files
- uniq: report or omit reported lines
- vi: vi IMproved
  - テキストエディタ。同様なエディタであるEmacsとどちらかは使えたほうが良い
  - vim上でsed/grep/sort/uniq等を使い整形することが可能。
​
---
# 3. コマンドを組み合わせる

---
## 3.a. コマンドを組み合わせる

先述の「シェルの基礎」の通り、pipe(`|`)や標準/エラー出力(`>`,`<`)等を使い、コマンドを連続処理する。

- ファイルを読みだして、文字列処理をする
  - `$ cat /etc/sudoers | sed -e "s/Future/future/" > mod-suduers.txt`
  - `$ tail /var/log/messages  | grep "error" > system-error.txt`

各自確認
  - 標準出力、エラー出力、/dev/null
---
# 4.正規表現

---
## 4.a. 正規表現の使い方を覚える
​
正規表現は、特定の記号(メタキャラクタ)で文字列を表現するもの。
複数の種類がある(拡張正規表現/Perlの正規表現/Emacsの正規表現、等)が、基本は同じ。
本テキストでは、正規表現を`sed`で利用して、文字列の置換等を行う。

- 使って覚える
  - 一般的に利用される正規表現の`記号`を覚える
  - 同 `パターン`を覚える
  - 組み合わせられるようになる

---
## 4.b. 正規表現で利用する記号

以下の記号で、文字列を表現する(代表的な物)
- 文字位置の指定
  - 文字列の頭 `^`
  - 文字列の末尾 `$`
- 文字の指定
  - 任意の1文字 `.`
  - 直前の文字が0回以上繰り返す `*`
  - 直前の文字が1回以上繰り返す `+`
- その他
  - エスケープ文字 `\`
  - 改行記号 `\n` `\r` 及びタブ記号 `\t`、除外での`^`
  - 特定の文字を指定する `[]`
  - 特定の文字列を指定する`()`

---
## 4.b.a 位置の指定

正規表現が含まれる行を選択する
- 行のすべて(何かの文字がある:任意の文字が0回以上)
  - `.*`
- 行頭が `a` から始まる行(abc..., aple..., など)
  - `^a.*`
- 行末が `ed.`で終わる行(...cpiled., ...end., など)
  - `.*`
- `This `で始まり、` pen.`で終わる行
  - `^This\ .*\ pen\.`

---
## 4.b.b 文字の指定

- 数字4桁
  - `[0-9][0-9][0-9][0-9]`
- 英単語(小文字で始まり、前後が空白で区切られている)
  - `\ [a-z]*\ `
- "the"及び"THE"を指定
  - `(the|THE)`
- 数字2桁と小文字の英単語の組合せ(区切りは半角空白)(` 10cron `など)
  - `\ [0-9][0-9][a-z]\ `

---
## 4.c. 文字や文字列の指定

---
### 4.c.1. 正規表現のパターン(日付)

日付: 月や日が2桁固定か1桁もありうるのか、等を考慮して適当に作る
- 2020/12/01
  - `[0-9]*\/[0-9]*\/[0-9]*`
  - `[0-9][0-9][0-9][0-9]\/[01][0-9]\/[0-9][0-9]`
- 2020-5-1
  - `[0-9]*-[0-9]*-[0-9]`
- 2020-12-01 01:12:23
  - `[0-9]*\/[0-9]*\/[0-9]*\ [0-9]*:[0-9]*:[0-9]*`
- Dec 01 01:12:23
  - `(Jun|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\ [0-1][0-9]\ [0-9]*:[0-9]*:[0-9]*`
  - `(A-Z)[a-z][a-z]\ [0-9]*\ [0-9]*:[0-9]*:[0-9]*`

---
### 4.c.2. 正規表現のパターン(IP)

ipAddress
- 0.0.0.0/0 (0.0.0.0-255.255.255.255)
  - `[0-9]*\.[0-9]*\.[0-9]*\.[0-9]*`
- 192.168.1.0/24 (192.168.1.0-192.168.1.255)
  - `192\.168\.1\.[0-9]*`
- 10.0.0.0/16 (10.0.0.0-10.0.255.255)
  - `10\.0\.[0-9]*\.[0-9]*`

---
### 4.c.3. (extra)利用例
ログ例(apache2:access.log)
```
196.52.43.119 - - [19/Dec/2020:02:54:46 +0000] "GET / HTTP/1.1" 200 58106 "-" "Go http package"
```

- IPアドレスを取得する
  - `s/^\([0-9]*\.[0-9]*\.[0-9]*.\[0-9]*\)\ .*/\1/g`
- リクエスト(GET, POSTなど)を取得する
  - `] "`から`HTTP/1.0`か`HTTP/1.1`迄を取得
    - `s/^.*\]\ \"\(.*\ HTTP\/1\.[01]\).*/\1/g`
- レスポンスステータスを取得する
  - responseCodeは3桁の数字であり、一旦、数字3桁、だけでの抽出
    - `s/^.*\ \([0-9][0-9][0-9]\)\ .*/\1/g`

※ログの他の行に合わせ、必要に応じてパターンを変える事。目的達成できれば手段は問わない。

---

# 4. 演習

提示する例題を解ければ、おおよそログを見るための処理をできるようになると考えられます。
どのような方法を利用しても構いません。望むものが得られれば、過程はどうでもよいです。

- 4.1 コマンド編
  - ログファイル自体の取り扱いで使うコマンドを記載します
- 4.2 文字列処理編
  - ログの文字列に対する処理例を記載します

---
## 4.1 コマンド編

---
### 4.1.a. bash関連

todo: これを答える問題を作る
- `echo file.txt | sort`
- `echo file.txt > filename.txt`
- `echo file.txt >> filename.txt`

---
### 4.1.b. ファイル操作関連

todo: これを答える問題を作る
- `cp a.log b.log`
- `rm a.log`
- `mv a.log moved.log`
- `tar cvfz`
- `tar xvfz`
- `zip `
- `unzip `

---
## 4.2 文字列処理編

---
### 4.2.a. aaa

todo: これを答える問題を作る
- `cat file.txt | sort > sortedfile.txt`
- `cat file.txt | sort -n | uniq -c`
- `head file.txt | tail -n 1`

---
### 4.2.b. bbb

- grep
  - 非正規表現、正規表現利用
- sed
  - `s/hoge/huga/g`
  - `g/.*/d`

---
### 4.2.c. vim

- `:w filename`, `:w!`, `:wq`, `ZZ`
- `1G`, `G`, `^`, `$`
- `dd`, `y`, 
- `/`(search) , `:set nohlsearch`
- `:set number`, `set wrap`
- `:%S/hoge/huga/g`
- `:%! sort | uniq -c | sort -nr`
- `Shift+v`, `Ctrl+v` + `$`, `^`
